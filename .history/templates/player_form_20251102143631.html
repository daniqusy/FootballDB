{% extends "base.html" %}
{% block body %}
<div class="container">
  <h1 class="h4">Player Form</h1>
  <form id="pf" class="row g-2 align-items-end">
  <div class="col-12 col-md-4 position-relative">
    <label class="form-label">Player</label>
    <input class="form-control" id="player-name" placeholder="Type player name">
    <input type="hidden" id="player-id">
    <div id="player-suggest" class="list-group position-absolute w-100" style="z-index:1000;"></div>
  </div>

  <div class="col-12 col-md-3">
    <label class="form-label">Competition</label>
    <select class="form-select" id="competition"></select>
  </div>

  <div class="col-12 col-md-3">
    <label class="form-label">Season</label>
    <select class="form-select" id="season"></select>
  </div>

  <div class="col-6 col-md-1">
    <label class="form-label">N</label>
    <input class="form-control" id="n" type="number" min="1" max="20" value="5">
  </div>

  <div class="col-6 col-md-1">
    <button class="btn btn-primary w-100" id="run-btn">Run</button>
  </div>
</form>
<small id="pf-meta" class="text-muted d-block mt-2"></small>
<table class="table table-sm mt-2">
  <thead><tr><th>Date</th><th>Min</th><th>G</th><th>A</th></tr></thead>
  <tbody id="pf-tbody"></tbody>
</table>
</div>
<script>
document.getElementById('pf').addEventListener('submit', async (e)=>{
  e.preventDefault();
  const p = new URLSearchParams(new FormData(e.target));
  const res = await fetch('/api/player/form?'+p.toString());
  const data = await res.json();
  document.getElementById('pf-meta').textContent = `Query time: ${data.ms} ms`;
  const tb = document.getElementById('pf-tbody'); tb.innerHTML='';
  data.rows.forEach(r=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${r.date||''}</td><td>${r.minutes_played}</td><td>${r.goals}</td><td>${r.assists}</td>`;
    tb.appendChild(tr);
  });
});
</script>
{% endblock %}

