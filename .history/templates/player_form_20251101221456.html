{% extends "base.html" %}
{% block body %}
<div class="container">
  <h1 class="h4">Player Form</h1>
  <form id="pf" class="row g-2">
    <div class="col"><input class="form-control" name="player_id" placeholder="Player ID" required></div>
    <div class="col"><input class="form-control" name="competition_id" placeholder="Competition ID" required></div>
    <div class="col"><input class="form-control" name="season" placeholder="Season (e.g., 2023)" required></div>
    <div class="col"><input class="form-control" name="n" type="number" min="1" max="20" value="5"></div>
    <div class="col-auto"><button class="btn btn-primary">Run</button></div>
  </form>
  <div id="pf-meta" class="mt-2 text-muted"></div>
  <table class="table table-sm mt-2">
    <thead><tr><th>Date</th><th>Min</th><th>G</th><th>A</th></tr></thead>
    <tbody id="pf-tbody"></tbody>
  </table>
</div>
<script>
document.getElementById('pf').addEventListener('submit', async (e)=>{
  e.preventDefault();
  const p = new URLSearchParams(new FormData(e.target));
  const res = await fetch('/api/player/form?'+p.toString());
  const data = await res.json();
  document.getElementById('pf-meta').textContent = `Query time: ${data.ms} ms`;
  const tb = document.getElementById('pf-tbody'); tb.innerHTML='';
  data.rows.forEach(r=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${r.date||''}</td><td>${r.minutes_played}</td><td>${r.goals}</td><td>${r.assists}</td>`;
    tb.appendChild(tr);
  });
});
</script>
{% endblock %}

