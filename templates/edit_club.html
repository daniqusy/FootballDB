{% extends "base.html" %} {% block body %}
<div class="container py-4">
  <h1 class="h4 mb-4">Edit Club</h1>
  <form id="ecf" class="row g-3">
    
    <!-- SECTION 1: Basic Info -->
    <div class="col-12">
      <h5 class="text-muted small text-uppercase fw-bold" style="letter-spacing: 0.5px;">Basic Information</h5>
    </div>

    <div class="col-12 col-md-6">
      <label class="form-label">Club Name *</label>
      <input class="form-control" id="name" required placeholder="e.g., Manchester United" />
    </div>

    <div class="col-12 col-md-6">
      <label class="form-label">Domestic Competition</label>
      <select class="form-select" id="domestic_competition_id">
        <option value="">Select Competition</option>
        <option value="L1">L1</option>
        <option value="RU1">RU1</option>
        <option value="TR1">TR1</option>
        <option value="IT1">IT1</option>
        <option value="GB1">GB1</option>
        <option value="BE1">BE1</option>
        <option value="DK1">DK1</option>
        <option value="NL1">NL1</option>
        <option value="GR1">GR1</option>
        <option value="PO1">PO1</option>
        <option value="SC1">SC1</option>
        <option value="ES1">ES1</option>
        <option value="UKR1">UKR1</option>
        <option value="FR1">FR1</option>
      </select>
    </div>

    <!-- SECTION 2: Squad Details -->
    <div class="col-12">
      <h5 class="text-muted small text-uppercase fw-bold mt-3" style="letter-spacing: 0.5px;">Squad Details</h5>
    </div>

    <div class="col-6 col-md-3">
      <label class="form-label">Squad Size</label>
      <input class="form-control" id="squad_size" type="number" placeholder="30" />
    </div>

    <div class="col-6 col-md-3">
      <label class="form-label">Average Age</label>
      <input class="form-control" id="average_age" type="number" step="0.1" placeholder="26.5" />
    </div>

    <!-- SECTION 3: Stadium Info -->
    <div class="col-12">
      <h5 class="text-muted small text-uppercase fw-bold mt-3" style="letter-spacing: 0.5px;">Stadium Information</h5>
    </div>

    <div class="col-12 col-md-6">
      <label class="form-label">Stadium Name</label>
      <input class="form-control" id="stadium_name" placeholder="e.g., Old Trafford" />
    </div>

    <div class="col-12 col-md-6">
      <label class="form-label">Stadium Seats</label>
      <input class="form-control" id="stadium_seats" type="number" placeholder="75000" />
    </div>

    <!-- SECTION 4: Submit -->
    <div class="col-12 pt-3 border-top">
      <button type="submit" id="submitBtn" class="btn btn-primary btn-lg">Update Club</button>
      <a href="/clubs" class="btn btn-secondary btn-lg">Cancel</a>
      <div id="result" class="mt-3"></div>
    </div>
  </form>
</div>

<script>
  const urlParams = new URLSearchParams(window.location.search);
  const clubId = urlParams.get("club_id");

  if (!clubId) {
    document.getElementById("result").textContent = "Error: Club ID not provided";
    document.getElementById("result").className = "mt-3 text-danger";
  } else {
    // Load club data
    async function loadClubData() {
      try {
        const res = await fetch(`/api/club/${clubId}/edit`);
        const data = await res.json();
        const club = data.row;

        if (!club) {
          document.getElementById("result").textContent = "Club not found";
          document.getElementById("result").className = "mt-3 text-danger";
          return;
        }

        // Fill form fields
        document.getElementById("name").value = club.name || "";
        document.getElementById("domestic_competition_id").value = club.domestic_competition_id || "";
        document.getElementById("squad_size").value = club.squad_size || "";
        document.getElementById("average_age").value = club.average_age || "";
        document.getElementById("stadium_name").value = club.stadium_name || "";
        document.getElementById("stadium_seats").value = club.stadium_seats || "";
      } catch (err) {
        console.error("Failed to load club data:", err);
        document.getElementById("result").textContent = "Failed to load club data";
        document.getElementById("result").className = "mt-3 text-danger";
      }
    }

    window.addEventListener("load", loadClubData);
  }

  document.getElementById("ecf").addEventListener("submit", async (e) => {
    e.preventDefault();
    const data = {
      name: document.getElementById("name").value,
      domestic_competition_id: document.getElementById("domestic_competition_id").value,
      squad_size: document.getElementById("squad_size").value,
      average_age: document.getElementById("average_age").value,
      stadium_name: document.getElementById("stadium_name").value,
      stadium_seats: document.getElementById("stadium_seats").value,
    };

    const resEl = document.getElementById("result");
    resEl.textContent = "Saving...";
    resEl.className = "mt-3";

    try {
      const resp = await fetch(`/api/club/${clubId}/update`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data),
      });
      const body = await resp.json();
      if (!resp.ok) {
        resEl.textContent =
          "Error: " + (body.error || JSON.stringify(body)) +
          (body.details ? " — " + body.details : "");
        resEl.className = "mt-3 text-danger";
        console.error(body);
        return;
      }
      resEl.innerHTML = `✓ Club updated successfully`;
      resEl.className = "mt-3 text-success";
      setTimeout(() => {
        window.location.href = "/clubs";
      }, 1500);
    } catch (err) {
      resEl.textContent = "Request failed: " + err.message;
      resEl.className = "mt-3 text-danger";
      console.error(err);
    }
  });
</script>
{% endblock %}
